<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ role.capitalize() }} Analytics - eMeet</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .analytics-container { max-width: 1000px; margin: 2rem auto; }
        .card-title { font-weight: 600; }
        .card-text { font-size: 2.5rem; }
    </style>
    
    <!-- PWA LINKS -->
    <link rel="manifest" href="{{ url_for('serve_manifest') }}">
    <script>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register("{{ url_for('serve_sw') }}")
          .then((reg) => console.log('Service worker registered.', reg))
          .catch((err) => console.log('Service worker not registered.', err));
      }
    </script>
    <!-- END PWA LINKS -->

</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-secondary">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for(role + '_dashboard') }}">Back to Dashboard</a>
            <a class="nav-link text-white" href="/logout">Logout</a>
        </div>
    </nav>
    
    <div class="analytics-container">
        <h2 class="mb-5 text-secondary">{{ role.capitalize() }} Appointment Analytics ðŸ“Š</h2>
        
        <!-- Summary Cards -->
        <div class="row g-4">
            {% for item in status_summary %}
            <div class="col-md-3 mb-3">
                <div class="card text-white text-center shadow-sm 
                    bg-{% if item.status == 'Approved' %}success
                    {% elif item.status == 'Rejected' %}danger
                    {% elif item.status == 'Rescheduled' %}info
                    {% else %}warning{% endif %}">
                    <div class="card-body">
                        <h5 class="card-title">{{ item.status }}</h5>
                        
                        <!-- 
                        THIS IS THE FIX!
                        Changed item.count to item.total
                        -->
                        <p class="card-text">{{ item.total }}</p>

                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- Monthly Trend Table -->
        <h4 class="mt-5 text-secondary">Monthly Performance Trend</h4>
        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead class="table-dark">
                    <tr>
                        <th>Month & Year</th>
                        <th>Total Requests</th>
                        <th>Approved Meetings</th>
                        <th>Approval/Completion Rate</th>
                    </tr>
                </thead>
                <tbody>
                    {% for trend in monthly_trend %}
                    <tr>
                        <!-- 
                        FIXED THE DATE DISPLAY:
                        This will show "11/2025" instead of "11.0/2025.0"
                        -->
                        <td>{{ "%.0f" | format(trend.month) }}/{{ "%.0f" | format(trend.year) }}</td>
                        <td>{{ trend.total_requests }}</td>
                        <td>{{ trend.approved_count }}</td>
                        <td>
                            {% if trend.total_requests > 0 %}
                                **{{ "%.1f" | format((trend.approved_count / trend.total_requests) * 100) }}%**
                            {% else %}
                                0%
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
